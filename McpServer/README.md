# 知识图谱 MCP 服务器

这是一个 MCP (Model Context Protocol) 服务器，用于连接 Claude AI 和知识图谱后端服务。它提供了一系列工具，允许 Claude 通过 API 调用来操作知识图谱，实现持久化记忆功能。

## 知识图谱概念

知识图谱记忆服务器是一个基于本地知识图谱实现的持久化记忆系统，能让Claude在不同对话间记住用户相关信息。

### 核心概念

#### 实体
实体是知识图谱中的主要节点。每个实体包含：
- 唯一名称（标识符）
- 实体类型（如"人物"、"组织"、"事件"）
- 观察项列表

示例：
```json
{
  "name": "张三",
  "entityType": "人物",
  "observations": ["能说流利的西班牙语"]
}
```

#### 关系
关系定义了实体间的有向连接。关系始终以主动语态存储，描述实体间的互动或关联。

示例：
```json
{
  "from": "张三",
  "to": "Anthropic公司",
  "relationType": "就职于"
}
```

#### 观察项
观察项是关于实体的离散信息单元。它们具有以下特点：
- 以字符串形式存储
- 附加到特定实体
- 可独立添加或删除
- 应保持原子性（每个观察项只包含一个事实）

示例：
```json
{
  "entityName": "张三",
  "observations": [
    "能说流利的西班牙语",
    "2019年毕业",
    "偏好早晨开会"
  ]
}
```

## 安装

```bash
# 安装依赖
npm install

# 构建项目
npm run build
```

## 使用方法

1. 确保知识图谱后端服务在 http://localhost:3000 运行
2. 启动 MCP 服务器：

```bash
npm start
```

或者：

```bash
node build/index.js
```

3. 在 Claude for Desktop 中配置 MCP 服务器，添加以下配置到 `claude_desktop_config.json`：

```json
{
    "mcpServers": {
        "knowledge-graph": {
            "command": "node",
            "args": [
                "/绝对路径/到/knowledge-graph-mcp/build/index.js"
            ]
        }
    }
}
```

## 可用工具

本 MCP 服务器提供以下工具：

1. **get_complete_graph** - 获取完整知识图谱，包括所有实体及其观察项和所有关系。

2. **create_entities** - 创建一个或多个新实体。实体是知识图谱的基本单位，代表人物、组织、地点、概念等。

3. **create_relations** - 创建实体之间的关系。关系描述两个实体间的有向连接，总是以主动语态表示（如"认识"、"拥有"、"隶属于"）。

4. **add_observations** - 向已有实体添加观察项。观察项是关于实体的原子化信息单元，每条观察应包含单一事实。

5. **delete_entities** - 删除一个或多个实体及其相关的关系。删除实体会同时删除该实体参与的所有关系，以及实体的所有观察项。

6. **delete_observations** - 删除实体的特定观察项。可以通过索引精确定位要删除的观察。

7. **delete_relations** - 删除知识图谱中的特定关系。可以通过指定源实体、目标实体和关系类型来精确删除特定关系。

8. **search_nodes** - 根据查询条件搜索实体。在实体名称、类型、属性和观察内容中查找匹配的实体。

9. **get_specific_nodes** - 按名称检索特定节点。当知道确切的实体名称，想要获取这些实体的详细信息及其相互关系时使用。

10. **load_graph** - 加载指定的知识图谱文件。系统支持管理多个知识图谱文件，此工具可以切换到特定的图谱文件。

11. **get_graph_files** - 获取可用的知识图谱文件列表。返回系统中所有可用的知识图谱文件。

12. **update_observation** - 更新实体的特定观察项。通过索引精确定位要更新的观察，可以修改观察的内容、时间戳和来源。

13. **update_entity_observations** - 一次性替换实体的所有观察项。用新的观察集合替换现有的所有观察。

14. **create_graph** - 创建一个新的知识图谱文件。初始化一个全新的、空白的知识图谱文件。

15. **delete_graph** - 删除指定的知识图谱文件。这是一个不可逆的操作，会永久删除指定的文件及其数据。

## 最佳实践

使用知识图谱记忆服务器时，请遵循以下最佳实践：

1. **保持观察的原子性** - 每个观察应只包含一个简洁的事实，便于后续查询和更新
2. **使用主动语态描述关系** - 关系应总是以主动语态表示，例如"认识"而不是"被认识"
3. **避免重复信息** - 在添加新观察前，先检查是否已存在类似信息
4. **命名一致性** - 在引用实体时，始终使用相同的名称标识符
5. **选择合适的工具** - 例如，大批量更新观察时使用update_entity_observations而不是多次调用update_observation

## 注意事项

- 此服务器默认连接到 http://localhost:3000/api/kg，确保知识图谱后端在此地址运行
- 如需修改连接地址，请更改代码中的 `KG_API_BASE` 常量
- 删除实体和知识图谱文件是不可逆操作，请谨慎使用 